
SELECT LT.TAGID , t.tagname
FROM POI.LOCATIONTAG LT 
LEFT JOIN POI.LOCATIONS LOC 
ON LT.LOCATIONID = LOC.LOCATIONID
left join poi.tag t
on lt.tagid = t.tagid
WHERE SOURCELOCATIONID = '222-222@5v9-8qv-cwk';



SELECT * FROM poi.OperationHour ;

select * from poi.locations
where locationid = 157645;

select * from poi.locations
where locationName = '007 Towing';
--169346	007 Towing	33.679480	-111.975801	185883	32	2025-08-23 20:32:20.8711604	Vanja\Vanja Mlinar	NULL	NULL	223-24t@5zb-x59-5cq


select * from poi.sourcedata
where locationName = '007 Towing'
/*ID	ParentID	Brand	BrandID	TopCategory	SubCategory	CategoryTags	PostalCode	LocationName	Latitude	Longitude	CountryCode	City	Region	OperationHours	GeometryType	Polygon_WKT
222-222@8ts-zg3-75z	NULL	NULL	NULL	Support Activities for Road Transportation	Motor Vehicle Towing	Towing	85026	007 Towing	33.450078	-111.975934	US	Phoenix	AZ	NULL	POLYGON	POLYGON ((-111.97520553599998 33.44896634100007, -111.97712944399996 33.44919564200006, -111.97712847999998 33.449412051000024, -111.97707974699995 33.449411902000065, -111.97707708399997 33.45000961100004, -111.97681717699999 33.45000881900006, -111.97681672799996 33.45010955600003, -111.97664616499998 33.450109035000025, -111.976644997 33.45037095300006, -111.97605208299996 33.450369142000056, -111.97605181299997 33.45042958500005, -111.97519086899996 33.450426951000054, -111.97519369799994 33.44979566300003, -111.97520181899995 33.44979568800005, -111.97520553599998 33.44896634100007))
223-24t@5zb-x59-5cq	22v-222@5zb-x59-52k	NULL	NULL	Support Activities for Road Transportation	Motor Vehicle Towing	Towing	85050	007 Towing	33.67948	-111.975801	US	Phoenix	AZ	NULL	POLYGON	POLYGON ((-111.97604947532739 33.67972602950504, -111.97569542373742 33.67970817349275, -111.97571151699151 33.67932426833136, -111.97607629741753 33.679333196377826, -111.97604947532739 33.67972602950504))
22c-227@5zb-xbf-6kz	NULL	NULL	NULL	Support Activities for Road Transportation	Motor Vehicle Towing	Towing	85017	007 Towing	33.480951	-112.132323	US	Phoenix	AZ	NULL	POLYGON	POLYGON ((-112.13208164399998 33.48103920700004, -112.13208310799996 33.48093176400005, -112.13217247999995 33.48093259500007, -112.13217476699998 33.48076471600007, -112.13236976099995 33.48076653100003, -112.13236601199998 33.48104185200003, -112.13208164399998 33.48103920700004))
*/



SELECT 
   *
FROM poi.SourceData s
JOIN poi.Locations l 
    ON l.LocationName = s.LocationName
    AND l.locationName = '007 Towing'    
JOIN poi.PostalCode pc 
    ON pc.PostalCodeID = l.PostalCodeID 
    AND Pc.postalcode = s.PostalCode
LEFT JOIN poi.SubCategory sc 
    ON sc.SubCategoryName = s.SubCategory
LEFT JOIN poi.Category c
    ON c.CategoryID = sc.CategoryID
   AND c.CategoryName = s.TopCategory
       order by locationid;
SELECT * FROM POI.poiLOCATIONS
WHERE LOCATIONID = 157646;

SELECT * FROM POI.LOCATIONS
WHERE LOCATIONID = 157646;



DECLARE @json NVARCHAR(MAX) = N'{
    "RegionCode": "AZ",
    "POICategory": "Religious Organizations"
}';

EXEC poi.GetPOIs_JSON @SearchCriteria = @json;


DECLARE @json NVARCHAR(MAX) = N'
{
    "CountryCode": "US",
    "RegionCode": "AZ",
    "CityName": "Phoenix",
    "CenterLat": 33.636371,
    "CenterLon": -112.150129,
    "RadiusMeters": 200

}';

EXEC poi.GetPOIs_JSON @SearchCriteria = @json;


-- Basic search by CountryCode
DECLARE @SearchCriteria NVARCHAR(MAX) =
N'{
    "CountryCode": "US",
    "RegionCode": null,
    "CityName": null,
    "CenterLat": null,
    "CenterLon": null,
    "RadiusMeters": null,
    "PolygonWKT": null,
    "POICategory": null,
    "POIName": null
}';

EXEC poi.GetPOIs_JSON @SearchCriteria;
GO

-- Search by country and region
DECLARE @SearchCriteria NVARCHAR(MAX) =
N'{
    "CountryCode": "US",
    "RegionCode": "AZ"
}';

EXEC poi.GetPOIs_JSON @SearchCriteria;
GO

-- Search by coordinates and radius
DECLARE @SearchCriteria NVARCHAR(MAX) =
N'{
    "CenterLat": 33.681653,
    "CenterLon": -112.114045,
    "RadiusMeters": 5000
}';

EXEC poi.GetPOIs_JSON @SearchCriteria;
GO
/*first ten
Id	LocationName	ParentName	CountryCode	RegionCode	CityName	Latitude	Longitude	Category	SubCategory	Polygon_WKT	PostalCode	OpeningHours
556738	Wonder Wax And Peel	NULL	US	AZ	Phoenix	33.523120	-112.047168	NULL	NULL	POLYGON ((-112.04720965353772 33.52316825124103, -112.04712522681803 33.52316881025537, -112.04712589737028 33.52307265974018, -112.0472110575065 33.52307210072522, -112.04720965353772 33.52316825124103))	85016	NULL
559174	Az Auto Tech Llc	NULL	US	AZ	Phoenix	33.680513	-112.113355	NULL	NULL	POLYGON ((-112.11322116432711 33.68056718754906, -112.11322384653619 33.68045893647669, -112.1134873735719 33.68046061046338, -112.11348670301959 33.68056495556957, -112.11322116432711 33.68056718754906))	85027	NULL
559517	Seatop Nails & Spa	Camelback Village Square	US	AZ	Phoenix	33.509799	-112.083362	NULL	NULL	POLYGON ((-112.08332482976357 33.50968847144929, -112.08340517929207 33.509689869202816, -112.08339936285591 33.50990931623087, -112.08331691792426 33.509907638930855, -112.08332482976357 33.50968847144929))	85013	NULL
562282	Vision Source	Lakeside Plaza	US	AZ	Phoenix	33.303518	-111.997838	NULL	NULL	POLYGON ((-111.99773286024015 33.30348108979911, -111.99794173726718 33.30347912829361, -111.99794207254331 33.303554506116754, -111.99773420134466 33.30355730826502, -111.99773286024015 33.30348108979911))	85048	NULL
564401	Hajoca	NULL	US	AZ	Phoenix	33.499149	-112.152333	NULL	NULL	POLYGON ((-112.152928267422 33.4994414165929, -112.15220407098798 33.49943694325182, -112.15220949388663 33.49897038594739, -112.1529417369477 33.49897933267761, -112.152928267422 33.4994414165929))	85031	NULL
568112	Orozco Auto Sales	NULL	US	AZ	Phoenix	33.450810	-112.114073	NULL	NULL	POLYGON ((-112.11427447198162 33.45101621060277, -112.11387214062938 33.451019375500806, -112.11386543510685 33.450604772875955, -112.11427849529514 33.4505936956794, -112.11427447198162 33.45101621060277))	85009	NULL
571194	Julio Gs Mexican	Village Plaza	US	AZ	Phoenix	33.600784	-111.978714	NULL	NULL	POLYGON ((-111.97883816902305 33.60074211157954, -111.97877111379768 33.600883973614636, -111.97859006468917 33.600825888400145, -111.97865309660102 33.600684026269455, -111.97883816902305 33.60074211157954))	85032	NULL
572986	Zoyo Neighborhood Yogurt	NULL	US	AZ	Phoenix	33.465471	-112.082258	NULL	NULL	POLYGON ((-112.08230003584958 33.46563553030861, -112.0822229223404 33.46563608969444, -112.0822178931985 33.465307170166646, -112.08228997756578 33.46530577169657, -112.08230003584958 33.46563553030861))	85007	NULL
575686	Central Music	NULL	US	AZ	Phoenix	33.510161	-112.074125	NULL	NULL	POLYGON ((-112.07399155816904 33.5101472180383, -112.07430001219677 33.510148615750325, -112.07429992934465 33.51019463972018, -112.07420437564082 33.51019436017963, -112.07420437564082 33.51019855341573, -112.07399248112097 33.51019967160771, -112.07399155816904 33.5101472180383))	85012	NULL
576329	Desert Schools Branch	NULL	US	AZ	Phoenix	33.517009	-112.063257	NULL	NULL	POLYGON ((-112.06304267048836 33.517045709764794, -112.06304132938385 33.51697750516387, -112.06347048282623 33.51697526894653, -112.06347182393074 33.51704123733361, -112.06304267048836 33.517045709764794))	85014	NULL
*/

-- Search by specific location polygon 
DECLARE @SearchCriteria NVARCHAR(MAX) =
N'{
    "PolygonWKT": "POLYGON ((-87.63191004099997 41.61032232200006, -87.63196132599995 41.61032228700003, -87.63196158499994 41.61053079800007, -87.63165386799994 41.61053100600003, -87.63165366899995 41.61036988400008, -87.63191009899998 41.61036971100003, -87.63191004099997 41.61032232200006))"
}';

EXEC poi.GetPOIs_JSON @SearchCriteria;
GO
--Id	LocationName	ParentName	CountryCode	RegionCode	CityName	Latitude	Longitude	Category	SubCategory	Polygon_WKT	PostalCode	OpeningHours
--555490	Peace & Goodwill Church of God In Christ	NULL	US	IL	Phoenix	41.610450	-87.631808	Religious Organizations	Religious Organizations	POLYGON ((-87.63191004099997 41.61032232200006, -87.63196132599995 41.61032228700003, -87.63196158499994 41.61053079800007, -87.63165386799994 41.61053100600003, -87.63165366899995 41.61036988400008, -87.63191009899998 41.61036971100003, -87.63191004099997 41.61032232200006))	60426	NULL


-- Select all restaurants in Oregon
DECLARE @SearchCriteria NVARCHAR(MAX) =
N'{
    "RegionCode": "OR",
    "POICategory": "Restaurant"
}';

EXEC poi.GetPOIs_JSON @SearchCriteria;
GO

/*first 10
Id	LocationName	ParentName	CountryCode	RegionCode	CityName	Latitude	Longitude	Category	SubCategory	Polygon_WKT	PostalCode	OpeningHours
594114	Vega's Mexican Hot Dogs	NULL	US	OR	Phoenix	42.270923	-122.812046	Restaurants and Other Eating Places	Limited-Service Restaurants	POLYGON ((-122.81182507772587 42.270938099999995, -122.8118369427165 42.27088245989457, -122.81187137626041 42.270832266230336, -122.81192500776244 42.27079243231287, -122.81199258739748 42.27076685736353, -122.8120675 42.270758044836576, -122.81214241260251 42.27076685736353, -122.81220999223756 42.27079243231287, -122.81226362373958 42.270832266230336, -122.8122980572835 42.27088245989457, -122.81230992227412 42.270938099999995, -122.8122980572835 42.27099374010542, -122.81226362373958 42.271043933769654, -122.81220999223756 42.271083767687124, -122.81214241260251 42.27110934263646, -122.8120675 42.271118155163414, -122.81199258739748 42.27110934263646, -122.81192500776244 42.271083767687124, -122.81187137626041 42.271043933769654, -122.8118369427165 42.27099374010542, -122.81182507772587 42.270938099999995))	97535	NULL
594511	Krispy Krunchy Chicken	Chevron	US	OR	Phoenix	42.279800	-122.820799	Restaurants and Other Eating Places	Limited-Service Restaurants	POLYGON ((-122.82077216299996 42.279914129000076, -122.82075053499995 42.27987449700004, -122.82068442699995 42.279893867000055, -122.82062434899996 42.27978377900007, -122.82069646599996 42.27976264900008, -122.82067003099996 42.279714210000066, -122.82081426499997 42.27967195000008, -122.82092240699996 42.27987010800007, -122.82077216299996 42.279914129000076))	97535	NULL
576283	Subway	NULL	US	OR	Phoenix	42.275509	-122.817310	Restaurants and Other Eating Places	Limited-Service Restaurants	POLYGON ((-122.81730338931084 42.27558119112569, -122.81721621751785 42.27549684495941, -122.8173141181469 42.275433337183244, -122.81740263104439 42.27552066035899, -122.81730338931084 42.27558119112569))	97535	Fri:9:00-21:00; Mon:9:00-21:00; Sat:9:00-21:00; Sun:9:00-21:00; Thu:9:00-21:00; Tue:9:00-21:00; Wed:9:00-21:00
594322	Dutch Bros Coffee	NULL	US	OR	Phoenix	42.279403	-122.820984	Restaurants and Other Eating Places	Snack and Nonalcoholic Beverage Bars	POLYGON ((-122.82098407070055 42.27936199605933, -122.8210259802164 42.279429468862816, -122.82098440597667 42.279445096744496, -122.82094115535631 42.27937737589588, -122.82098407070055 42.27936199605933))	97535	Fri:5:00-23:00; Mon:5:00-22:00; Sat:5:00-23:00; Sun:5:00-22:00; Thu:5:00-22:00; Tue:5:00-22:00; Wed:5:00-22:00
573372	Main Street Yogurt & Ice	NULL	US	OR	Phoenix	42.278971	-122.822252	Restaurants and Other Eating Places	Snack and Nonalcoholic Beverage Bars	POLYGON ((-122.82245548745806 42.278824805866215, -122.82220046300354 42.27915812730238, -122.82214989799996 42.27911921100008, -122.82212177299999 42.27913883200006, -122.82210392099995 42.27912509300006, -122.82208517 42.279138173000035, -122.82196913599995 42.279048868000075, -122.82200194999996 42.27902597700006, -122.82197517099996 42.27900536800007, -122.82199392299998 42.27899228800004, -122.82194929399998 42.278957940000055, -122.82230555299998 42.27870941000003, -122.82245548745806 42.278824805866215))	97535	NULL
560535	Iron Skillet Restaurant	Petro Stopping Center	US	OR	Phoenix	42.279558	-122.811557	Restaurants and Other Eating Places	Full-Service Restaurants	POLYGON ((-122.8116562678947 42.27940784659942, -122.81176494912683 42.27961281253629, -122.81151380348962 42.27968509316124, -122.81150383915008 42.27966819028231, -122.81141681603856 42.27969343746667, -122.81135005805658 42.27956589422684, -122.81140584540816 42.279549584415236, -122.81137002690826 42.279483061382756, -122.8116562678947 42.27940784659942))	97535	Fri:6:00-23:00; Mon:6:00-23:00; Sat:6:00-23:00; Sun:6:00-23:00; Thu:6:00-23:00; Tue:6:00-23:00; Wed:6:00-23:00
579546	Lumpy's	NULL	US	OR	Phoenix	42.278541	-122.821699	Restaurants and Other Eating Places	Full-Service Restaurants	POLYGON ((-122.82130433599997 42.27871211900003, -122.82195122799999 42.278260845000034, -122.82209403799999 42.27837075900004, -122.82144714599997 42.27882203400003, -122.82130433599997 42.27871211900003))	97535	NULL
575485	Figaro's PIzza	NULL	US	OR	Phoenix	42.275514	-122.817300	Restaurants and Other Eating Places	Full-Service Restaurants	POLYGON ((-122.81721627999997 42.27550428700005, -122.817299376 42.275451443000065, -122.817384216 42.27552307800005, -122.81730112099996 42.27557592200003, -122.81721627999997 42.27550428700005))	97535	Fri:11:00-21:00; Mon:11:00-21:00; Sat:11:00-21:00; Sun:11:00-21:00; Thu:11:00-21:00; Tue:11:00-21:00; Wed:11:00-21:00
589770	Angelo's Pizza	NULL	US	OR	Phoenix	42.279071	-122.821607	Restaurants and Other Eating Places	Full-Service Restaurants	POLYGON ((-122.82162104599996 42.27896392500003, -122.82164211599996 42.27895027400007, -122.82177502199994 42.279060412000035, -122.82157137499996 42.27919235400003, -122.82143846799994 42.279082215000074, -122.82162104599996 42.27896392500003))	97535	Fri:11:00-22:00; Mon:11:00-21:00; Sat:11:00-22:00; Sun:11:00-21:00; Thu:11:00-21:00; Tue:11:00-21:00; Wed:11:00-21:00
593721	Luigi's of Phoenix	The Shoppes At Exit 24	US	OR	Phoenix	42.283042	-122.818050	Restaurants and Other Eating Places	Full-Service Restaurants	POLYGON ((-122.81815115499995 42.28318546700007, -122.81795026599997 42.28307346400004, -122.81793795199997 42.28300700400007, -122.81808308099994 42.282992568000054, -122.81807569199998 42.28295269200004, -122.81816976299996 42.28286211200003, -122.81820066899996 42.28287934400004, -122.81829473799996 42.28278876400003, -122.81832564399997 42.282805996000036, -122.81839619599998 42.28273806100003, -122.81850436699995 42.282798369000034, -122.81855924099995 42.282745532000035, -122.81850257999997 42.282713941000054, -122.81849082099995 42.28272526300003, -122.81841355599994 42.282682186000045, -122.81836306699995 42.28240969900003, -122.81840841899998 42.28240518800004, -122.81839856799996 42.282352020000076, -122.81835321599999 42.28235653100006, -122.81826824699999 42.28189795600008, -122.81830452899999 42.28189434700005, -122.81829344599998 42.28183453300005, -122.81825716399999 42.281838142000026, -122.81822761099994 42.28167863800007, -122.81829110299998 42.281672323000066, -122.81828740899999 42.28165238400004, -122.81852324 42.281628925000064, -122.81871042199998 42.28263911800008, -122.81866506799997 42.28264362900006, -122.81869216099994 42.28278984100007, -122.81849226399999 42.282982323000056, -122.81847165999994 42.28297083700005, -122.81840502699998 42.28303499700007, -122.81838442299994 42.28302350900003, -122.81830995099995 42.28309521800003, -122.81828934699996 42.28308373100003, -122.81823447299996 42.28313656900008, -122.81821386799999 42.28312508100004, -122.81815115499995 42.28318546700007))	97535	NULL
*/

-- Select all restaurants with "pizza" in their name in Oregon
DECLARE @SearchCriteria NVARCHAR(MAX) =
N'{
    "CenterLat": 42.2773,
    "CenterLon": -122.81945,
    "RadiusMeters": 1000,
    "POIName": "Pizza",
    "RegionCode": "OR",
    "POICategory": "Restaurant"
}';

EXEC poi.GetPOIs_JSON @SearchCriteria;
GO

/*
Id	LocationName	ParentName	CountryCode	RegionCode	CityName	Latitude	Longitude	Category	SubCategory	Polygon_WKT	PostalCode	OpeningHours
575485	Figaro's PIzza	NULL	US	OR	Phoenix	42.275514	-122.817300	Restaurants and Other Eating Places	Full-Service Restaurants	POLYGON ((-122.81721627999997 42.27550428700005, -122.817299376 42.275451443000065, -122.817384216 42.27552307800005, -122.81730112099996 42.27557592200003, -122.81721627999997 42.27550428700005))	97535	Fri:11:00-21:00; Mon:11:00-21:00; Sat:11:00-21:00; Sun:11:00-21:00; Thu:11:00-21:00; Tue:11:00-21:00; Wed:11:00-21:00
589770	Angelo's Pizza	NULL	US	OR	Phoenix	42.279071	-122.821607	Restaurants and Other Eating Places	Full-Service Restaurants	POLYGON ((-122.82162104599996 42.27896392500003, -122.82164211599996 42.27895027400007, -122.82177502199994 42.279060412000035, -122.82157137499996 42.27919235400003, -122.82143846799994 42.279082215000074, -122.82162104599996 42.27896392500003))	97535	Fri:11:00-22:00; Mon:11:00-21:00; Sat:11:00-22:00; Sun:11:00-21:00; Thu:11:00-21:00; Tue:11:00-21:00; Wed:11:00-21:00
*/

--
DECLARE @SearchCriteria NVARCHAR(MAX) =
N'{
    "POIName": "Angelo''s Pizza",
    "POICategory": "Restaurant",
    "CountryCode": "US",
    "RegionCode": "OR",
    "CityName": "Phoenix",
    "CenterLat": 42.279071,
    "CenterLon": -122.821607,
    "RadiusMeters": 500,
    "PolygonWKT": null
}';

EXEC poi.GetPOIs_JSON @SearchCriteria;
GO

/*
Id	LocationName	ParentName	CountryCode	RegionCode	CityName	Latitude	Longitude	Category	SubCategory	Polygon_WKT	PostalCode	OpeningHours
589770	Angelo's Pizza	NULL	US	OR	Phoenix	42.279071	-122.821607	Restaurants and Other Eating Places	Full-Service Restaurants	POLYGON ((-122.82162104599996 42.27896392500003, -122.82164211599996 42.27895027400007, -122.82177502199994 42.279060412000035, -122.82157137499996 42.27919235400003, -122.82143846799994 42.279082215000074, -122.82162104599996 42.27896392500003))	97535	Fri:11:00-22:00; Mon:11:00-21:00; Sat:11:00-22:00; Sun:11:00-21:00; Thu:11:00-21:00; Tue:11:00-21:00; Wed:11:00-21:00
/

